
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dual AI Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Optional: web-hosted fonts for Latin + CJK (replace if you use local files) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Font families – replace the first entry with your preferred font(s) */
      --font-latin: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue";
      --font-cjk: "Noto Sans SC", "PingFang SC", "Microsoft YaHei", "Heiti SC", "WenQuanYi Micro Hei";
      --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

      /* Serif stacks for requested areas */
      --font-latin-serif: "Georgia", "Times New Roman", "Palatino Linotype", "Book Antiqua", "Palatino", serif;
      --font-cjk-serif: "Noto Serif SC", "Songti SC", "STSong", "SimSun", "Source Han Serif SC", serif;

      /* Type scale (relative to html root size which you already scale) */
      --fs-body: 1.25rem;   /* ~17–18px at default */
      --lh-body: 1.6;       /* comfortable multi-language line height */
      --track-body: 0.003em;/* subtle tracking for readability */

      /* Headings derived from body size */
      --fs-h1: 1.6em;  /* ~28–30px when body ~17–18px */
      --fs-h2: 1.35em; /* ~23–24px */
      --fs-h3: 1.15em; /* ~19–20px */
      --lh-heading: 1.3;
      --weight-body: 400;
      --weight-heading: 600;
    }
    /* Custom scrollbar for webkit browsers - Light Theme */
    ::-webkit-scrollbar {
      width: 6px; /* slimmer global */
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: #e5e7eb; /* gray-200 */
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb {
      background: #9ca3af; /* gray-400 */
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #6b7280; /* gray-500 */
    }
    body {
      font-family: var(--font-latin), var(--font-cjk), sans-serif;
      font-size: var(--fs-body);
      line-height: var(--lh-body);
      letter-spacing: var(--track-body);
      font-weight: var(--weight-body);
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Prefer CJK stack for Chinese content */
    :lang(zh), :lang(zh-CN), :lang(zh-SG), :lang(zh-HK), :lang(zh-TW) {
      font-family: var(--font-cjk), var(--font-latin), sans-serif;
      letter-spacing: 0.01em; /* slightly looser for Han characters */
    }

    /* Utility: force serif for specific UI sections */
    .serif-text { font-family: var(--font-latin-serif), var(--font-cjk-serif), serif; }
    .serif-text:lang(zh),
    .serif-text:lang(zh-CN),
    .serif-text:lang(zh-SG),
    .serif-text:lang(zh-HK),
    .serif-text:lang(zh-TW) { font-family: var(--font-cjk-serif), var(--font-latin-serif), serif; }

    /* Global heading rhythm (outside markdown) */
    h1 { font-size: var(--fs-h1); line-height: var(--lh-heading); font-weight: var(--weight-heading); }
    h2 { font-size: var(--fs-h2); line-height: var(--lh-heading); font-weight: var(--weight-heading); }
    h3 { font-size: var(--fs-h3); line-height: var(--lh-heading); font-weight: var(--weight-heading); }

    /* Styles for modal content scrollbar if needed */
    .settings-modal-content-scrollbar::-webkit-scrollbar {
      width: 4px; /* even thinner for modal content */
    }
    .settings-modal-content-scrollbar::-webkit-scrollbar-track {
        background: #f9fafb; /* gray-50, lighter for modal content area */
    }
    .settings-modal-content-scrollbar::-webkit-scrollbar-thumb {
        background: #d1d5db; /* gray-300 */
    }
    .settings-modal-content-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #9ca3af; /* gray-400 */
    }


    /* Light theme styles for Markdown preview in Notepad */
    .markdown-preview {
      padding: 0.75rem; /* p-3 */
      color: #1f2937; /* match chat text-gray-800 */
      font-family: var(--font-latin), var(--font-cjk), sans-serif; /* match chat sans-serif */
      font-size: 28px; /* Canvas body size */
      line-height: 1.7; /* slightly taller for readability */
      background-color: #ffffff; /* bg-gray-50 */
      height: 100%;
      overflow-y: auto;
    }
    .markdown-preview h1,
    .markdown-preview h2,
    .markdown-preview h3,
    .markdown-preview h4,
    .markdown-preview h5,
    .markdown-preview h6 {
      color: #1f2937; /* match chat heading color (black-ish) */
      margin-top: 1.25em; /* clearer section separation */
      margin-bottom: 0.7em; /* more space below heading */
      font-weight: var(--weight-heading);
    }
    .markdown-preview h1 { font-size: 40px; font-weight: 700; }
    .markdown-preview h2 { font-size: 32px; /* h2..h6 keep semi-bold via var */ }
    .markdown-preview h3 { font-size: 28px; }
    .markdown-preview p { margin-bottom: 0.9em; color: #1f2937; }
    .markdown-preview ul,
    .markdown-preview ol {
      margin-left: 1.5em;
      margin-bottom: 0.85em;
      list-style-position: outside;
      color: #1f2937;
    }
    .markdown-preview ul { list-style-type: disc; }
    .markdown-preview ol { list-style-type: decimal; }
    .markdown-preview li { margin-bottom: 0.25em; }
    .markdown-preview blockquote {
      border-left: 4px solid #d1d5db; /* border-gray-300 */
      padding-left: 1em;
      margin-left: 0;
      margin-bottom: 0.75em;
      color: #6b7280; /* text-gray-500 */
      font-style: italic;
    }
    .markdown-preview pre {
      background-color: #f3f4f6; /* bg-gray-100 */
      padding: 0.75em;
      border-radius: 0.375rem; /* rounded-md */
      overflow-x: auto;
      margin-bottom: 0.75em;
      color: #1f2937; /* text-gray-800 */
      border: 1px solid #e5e7eb; /* border-gray-200 */
    }
    .markdown-preview code { /* Inline code */
      background-color: #e5e7eb; /* bg-gray-200 */
      color: #c026d3; /* A generic darker pink/purple for inline code */
      padding: 0.2em 0.4em;
      border-radius: 0.25rem;
      font-size: 0.9em; /* Relative to 1.25rem of .markdown-preview */
    }
    .markdown-preview pre code { /* Code within pre blocks */
      background-color: transparent;
      padding: 0;
      font-size: 1em; /* Relative to parent pre, which inherits from .markdown-preview */
      color: inherit;
    }
    .markdown-preview a {
      color: #0369a1; /* text-sky-700 */
      text-decoration: underline;
    }
    .markdown-preview hr {
      border-top: 1px solid #d1d5db; /* border-gray-300 */
      margin: 1em 0;
    }

    /* Light theme styles for Markdown content within chat bubbles
       Align visual parsing to Canvas (Notepad) while keeping chat fonts */
    .chat-markdown-content {
      line-height: 1.7; /* match Canvas rhythm */
      color: #1f2937; /* Canvas body color */
    }
    .chat-markdown-content h1,
    .chat-markdown-content h2,
    .chat-markdown-content h3,
    .chat-markdown-content h4,
    .chat-markdown-content h5,
    .chat-markdown-content h6 {
      color: #1f2937; /* Canvas heading color */
      margin-top: 1.25em; /* Canvas spacing */
      margin-bottom: 0.7em; /* Canvas spacing */
      font-weight: var(--weight-heading);
      line-height: var(--lh-heading);
    }
    .chat-markdown-content h1 { font-size: var(--fs-h2); }
    .chat-markdown-content h2 { font-size: var(--fs-h3); }
    .chat-markdown-content h3 { font-size: 1.05em; }
    .chat-markdown-content p { margin-bottom: 0.9em; color: #1f2937; }
    .chat-markdown-content ul,
    .chat-markdown-content ol {
      margin-left: 1.5em; /* Canvas indent */
      margin-bottom: 0.85em;
      list-style-position: outside;
      color: #1f2937;
    }
    .chat-markdown-content ul { list-style-type: disc; }
    .chat-markdown-content ol { list-style-type: decimal; }
    .chat-markdown-content li { margin-bottom: 0.25em; }
    .chat-markdown-content blockquote {
      border-left: 4px solid #d1d5db; /* Canvas border */
      padding-left: 1em;
      margin-left: 0;
      margin-bottom: 0.75em;
      color: #6b7280; /* Canvas quote text */
      font-style: italic;
    }
    .chat-markdown-content pre {
      background-color: #f3f4f6; /* Canvas code bg */
      padding: 0.75em;
      border-radius: 0.375rem; /* rounded-md */
      overflow-x: auto;
      margin-bottom: 0.75em;
      color: #1f2937; /* text-gray-800 */
      border: 1px solid #e5e7eb; /* border-gray-200 */
      font-family: var(--font-mono);
      font-size: 0.875rem; /* keep chat size */
    }
    .chat-markdown-content code { /* Inline code */
      background-color: #e5e7eb; /* Canvas inline code bg */
      color: #c026d3; /* Canvas inline code fg */
      padding: 0.2em 0.4em;
      border-radius: 0.25rem;
      font-size: 0.9em; /* relative to chat base */
      font-family: var(--font-mono);
    }
    .chat-markdown-content pre code { /* Code within pre blocks */
      background-color: transparent;
      padding: 0;
      font-size: 1em;
      color: inherit;
    }
    .chat-markdown-content a {
      color: #0369a1; /* Canvas link */
      text-decoration: underline;
    }
    .chat-markdown-content a:hover { color: #0369a1; }
    .chat-markdown-content hr {
      border-top: 1px solid #d1d5db; /* Canvas rule */
      margin: 1em 0;
    }
    /* Extra-slim scrollbar specifically for chat list */
    .chat-scrollbar::-webkit-scrollbar {
      width: 4px;
      height: 4px;
    }
    .chat-scrollbar::-webkit-scrollbar-track {
      background: #f3f4f6; /* gray-100 */
    }
    .chat-scrollbar::-webkit-scrollbar-thumb {
      background: #d1d5db; /* gray-300 */
      border-radius: 10px;
    }
    .chat-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #9ca3af; /* gray-400 */
    }

    /* Notepad (Canvas) scrollbars */
    .notepad-scrollbar::-webkit-scrollbar {
      width: 4px;
      height: 4px;
    }
    .notepad-scrollbar::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 10px;
    }
    .notepad-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }
    /* Hide scrollbars visually but keep scrolling for opted-in elements */
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .no-scrollbar::-webkit-scrollbar { display: none; width: 0; height: 0; background: transparent; }

    /* ===== Mixture-of-Agents: Two Dots Loading Spinner ===== */
    .moa-two-dots {
      --moa-dot-size: 8px;          /* default diameter */
      --moa-gap: 6px;               /* space between dots */
      --moa-duration: 1s;           /* full alternation period */
      display: inline-flex;
      align-items: center;
      gap: var(--moa-gap);
      line-height: 0;               /* vertical alignment for tight layout */
    }
    .moa-two-dots .moa-dot {
      width: var(--moa-dot-size);
      height: var(--moa-dot-size);
      border-radius: 9999px;
      background-color: #AECBFA; /* initial light blue */
      will-change: transform, background-color;
      animation: moaTwoDotsPulse var(--moa-duration) cubic-bezier(0.4, 0, 0.2, 1) infinite;
      transform-origin: center;
    }
    .moa-two-dots .moa-dot.second {
      /* offset by half a cycle so the two dots alternate */
      animation-delay: calc(var(--moa-duration) / 2);
    }

    @keyframes moaTwoDotsPulse {
      0% {
        transform: scale(1.15);
        background-color: #4285F4; /* Google blue */
      }
      25% {
        transform: scale(1.00);
        background-color: #78A8F7; /* mid blue (inferred) */
      }
      50% {
        transform: scale(0.85);
        background-color: #AECBFA; /* light blue */
      }
      75% {
        transform: scale(1.00);
        background-color: #78A8F7; /* mid blue */
      }
      100% {
        transform: scale(1.15);
        background-color: #4285F4; /* Google blue */
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .moa-two-dots .moa-dot { animation: none; }
    }

    /* ===== Thinking… Shimmer + Caret ===== */
    .thinking-shimmer-text {
      position: relative;
      display: inline-block;
      /* Use current text color for base, white for highlight */
      background-image: linear-gradient(
        90deg,
        currentColor 0%,
        currentColor 40%,
        rgba(255, 255, 255, 0.98) 50%,
        currentColor 60%,
        currentColor 100%
      );
      background-size: 200% 100%;
      background-position: -20% 0; /* start just left of the first letter */
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      -webkit-text-fill-color: transparent;
      /* After ~1s delay (≈ 3 cursor cycles), start scanning */
      animation: thinkingShimmerScan 2.6s ease-in-out 1s infinite alternate;
    }
    @keyframes thinkingShimmerScan {
      0% { background-position: -20% 0; }
      100% { background-position: 120% 0; }
    }

    .thinking-caret {
      display: inline-block;
      width: 0.5em;
      height: 0.85em;
      margin-left: 0.18em;
      background-color: #000; /* starts black */
      animation: thinkingCaretBlink 0.333s ease-in-out infinite;
      vertical-align: -0.06em; /* align with text baseline */
    }
    @keyframes thinkingCaretBlink {
      0%   { background-color: #000; }
      50%  { background-color: #fff; }
      100% { background-color: #000; }
    }

    @media (prefers-reduced-motion: reduce) {
      .thinking-shimmer-text {
        animation: none;
        background: none;
        color: currentColor;
        -webkit-text-fill-color: currentColor;
      }
      .thinking-caret { animation: none; }
    }

    /* ===== Theme: Claude Style (Off‑white UI) ===== */
    /* Use a neutral warm off‑white across the app */
    :root { --claude-offwhite: #FAF9F6; --claude-track: #F1EEE8; }
    html[data-theme='claude'] body { background-color: var(--claude-offwhite); }
    /* Turn generic white surfaces to off‑white */
    html[data-theme='claude'] .bg-white { background-color: var(--claude-offwhite) !important; }
    html[data-theme='claude'] .markdown-preview { background-color: var(--claude-offwhite) !important; }
    html[data-theme='claude'] .notepad-scrollbar::-webkit-scrollbar-track { background: var(--claude-track); }
    html[data-theme='claude'] .settings-modal-content-scrollbar::-webkit-scrollbar-track { background: var(--claude-track); }
    /* Exception: keep the chat message input area pure white */
    html[data-theme='claude'] .chat-input-area textarea { background-color: #ffffff !important; }
    html[data-theme='claude'] .chat-input-area .bg-white { background-color: #ffffff !important; }
    /* Claude: MoE done badge (circle) -> orange */
    html[data-theme='claude'] .moa-done-badge circle { fill: #C46345 !important; }

    /* ===== Theme: Dark Mode ===== */
    :root { --dark-bg: #272727; --dark-input: #2e2e2e; --dark-text: #ffffff; --dark-text-muted: #B3B3B3; }
    /* Default text in Dark = muted gray (chat area will override to white) */
    html[data-theme='dark'] body { background-color: var(--dark-bg); color: var(--dark-text-muted); }
    /* Turn all generic white surfaces into dark charcoal */
    html[data-theme='dark'] .bg-white { background-color: var(--dark-bg) !important; }
    html[data-theme='dark'] .markdown-preview { background-color: var(--dark-bg) !important; color: var(--dark-text-muted) !important; }
    /* Global text variants to muted gray */
    html[data-theme='dark'] .text-black,
    html[data-theme='dark'] .text-gray-900,
    html[data-theme='dark'] .text-gray-800,
    html[data-theme='dark'] .text-gray-700,
    html[data-theme='dark'] .text-gray-600,
    html[data-theme='dark'] .text-gray-500,
    html[data-theme='dark'] .serif-text,
    html[data-theme='dark'] .markdown-preview h1,
    html[data-theme='dark'] .markdown-preview h2,
    html[data-theme='dark'] .markdown-preview h3,
    html[data-theme='dark'] .markdown-preview h4,
    html[data-theme='dark'] .markdown-preview h5,
    html[data-theme='dark'] .markdown-preview h6,
    html[data-theme='dark'] a { color: var(--dark-text-muted) !important; }
    /* Chat area remains white text */
    html[data-theme='dark'] #chat-panel-wrapper,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content h1,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content h2,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content h3,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content h4,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content h5,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content h6,
    html[data-theme='dark'] #chat-panel-wrapper .text-gray-900,
    html[data-theme='dark'] #chat-panel-wrapper .text-gray-800,
    html[data-theme='dark'] #chat-panel-wrapper .text-gray-700,
    html[data-theme='dark'] #chat-panel-wrapper .text-gray-600,
    html[data-theme='dark'] #chat-panel-wrapper .text-gray-500 { color: var(--dark-text) !important; }
    /* Chat input area: input slightly lighter than page */
    html[data-theme='dark'] .chat-input-area textarea {
      background-color: var(--dark-input) !important;
      color: var(--dark-text) !important;
      border-color: #3a3a3a !important;
    }
    html[data-theme='dark'] .chat-input-area textarea::placeholder { color: var(--dark-text); opacity: 0.7; }
    /* Darker separators */
    html[data-theme='dark'] .bg-gray-200 { background-color: #3a3a3a !important; }
    html[data-theme='dark'] .border-gray-200 { border-color: #3a3a3a !important; }
    html[data-theme='dark'] hr { border-top-color: #3a3a3a !important; }
    /* Settings/Config surfaces use dark bg (including gray-50/100) */
    html[data-theme='dark'] .bg-gray-50,
    html[data-theme='dark'] .bg-gray-100 { background-color: var(--dark-bg) !important; }
    /* Settings toggles: on = orange, off = gray (unchanged) */
    html[data-theme='dark'] .settings-modal-content-scrollbar button.bg-black { background-color: #C46345 !important; }

    /* User chat bubble: pure black background */
    html[data-theme='dark'] #chat-panel-wrapper .user-bubble {
      background-color: #000000 !important;
      color: var(--dark-text) !important;
    }

    /* Scrollbars in Dark: use separator gray */
    html[data-theme='dark'] ::-webkit-scrollbar-thumb { background: #3a3a3a; }
    html[data-theme='dark'] ::-webkit-scrollbar-track { background: #2a2a2a; }

    /* MoE step cards: borders = separator gray; surfaces = dark; arrow = gray (no white circle) */
    html[data-theme='dark'] .moa-step-card { border-color: #3a3a3a !important; }
    html[data-theme='dark'] .moa-step-card-header { background-color: var(--dark-bg) !important; color: var(--dark-text) !important; }
    html[data-theme='dark'] .moa-step-card-body { background-color: var(--dark-bg) !important; color: var(--dark-text) !important; }
    html[data-theme='dark'] .moa-step-card-debug { background-color: var(--dark-bg) !important; color: var(--dark-text-muted) !important; border-top-color: #3a3a3a !important; }
    html[data-theme='dark'] .moa-step-arrow { background-color: transparent !important; }
    html[data-theme='dark'] .moa-step-arrow svg { color: #B3B3B3; }
    /* Dark: MoE done badge (circle) -> orange */
    html[data-theme='dark'] .moa-done-badge circle { fill: #C46345 !important; }

    /* Dark: Make the panel resizer visible and consistent with other separators */
    html[data-theme='dark'] #panel-resizer { background-color: #3a3a3a !important; }
    html[data-theme='dark'] #panel-resizer:hover { background-color: #4a4a4a !important; }

    /* ===== Dark Mode: Notepad Canvas (Markdown preview) precise overrides ===== */
    /* Body text in dark: softer gray to let headings stand out */
    html[data-theme='dark'] .markdown-preview p,
    html[data-theme='dark'] .markdown-preview ul,
    html[data-theme='dark'] .markdown-preview ol,
    html[data-theme='dark'] .markdown-preview li { color: #B0B0B0 !important; }

    /* Headings in dark: H1 brightest, H2 slightly dimmer, others bright */
    html[data-theme='dark'] .markdown-preview h1 { color: #F5F5F5 !important; }
    html[data-theme='dark'] .markdown-preview h2 { color: #D4D4D4 !important; }
    html[data-theme='dark'] .markdown-preview h3,
    html[data-theme='dark'] .markdown-preview h4,
    html[data-theme='dark'] .markdown-preview h5,
    html[data-theme='dark'] .markdown-preview h6 { color: var(--dark-text) !important; }

    /* Bold/strong emphasis in dark */
    html[data-theme='dark'] .markdown-preview strong,
    html[data-theme='dark'] .markdown-preview b { color: #D4D4D4 !important; }

    /* Links: readable accent on dark */
    html[data-theme='dark'] .markdown-preview a { color: #7DD3FC !important; }
    html[data-theme='dark'] .markdown-preview a:hover { color: #BAE6FD !important; }

    /* Blockquotes: softer text and stronger left border */
    html[data-theme='dark'] .markdown-preview blockquote { color: var(--dark-text-muted) !important; border-left-color: #4B5563 !important; }

    /* Inline code tokens */
    html[data-theme='dark'] .markdown-preview code { background-color: #2E2E2E !important; color: #E9D5FF !important; }

    /* Fenced code blocks */
    html[data-theme='dark'] .markdown-preview pre { background-color: #1E1E1E !important; color: var(--dark-text) !important; border-color: #3A3A3A !important; }
    html[data-theme='dark'] .markdown-preview pre code { color: inherit !important; background: transparent !important; }

    /* Horizontal rules */
    html[data-theme='dark'] .markdown-preview hr { border-top-color: #3A3A3A !important; }

    /* Dark Mode: Chat bubbles (Markdown) to match Canvas palette */
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content p,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content ul,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content ol,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content li { color: #B0B0B0 !important; }

    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content h1 { color: #F5F5F5 !important; }
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content h2 { color: #D4D4D4 !important; }
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content h3,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content h4,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content h5,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content h6 { color: var(--dark-text) !important; }

    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content strong,
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content b { color: #D4D4D4 !important; }

    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content a { color: #7DD3FC !important; }
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content a:hover { color: #BAE6FD !important; }

    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content blockquote { color: var(--dark-text-muted) !important; border-left-color: #4B5563 !important; }

    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content code { background-color: #2E2E2E !important; color: #E9D5FF !important; }

    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content pre { background-color: #1E1E1E !important; color: var(--dark-text) !important; border-color: #3A3A3A !important; }
    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content pre code { color: inherit !important; background: transparent !important; }

    html[data-theme='dark'] #chat-panel-wrapper .chat-markdown-content hr { border-top-color: #3A3A3A !important; }

    /* Dark Mode: Notepad editing textarea (inside right panel) */
    html[data-theme='dark'] #notepad-panel-wrapper textarea {
      background-color: var(--dark-bg) !important;
      color: var(--dark-text) !important;
      border-color: #3a3a3a !important;
    }

    /* Prompt Optimizer animated rainbow border (start -> active -> end) */
    .chat-input-area.optimizer-start textarea,
    .chat-input-area.optimizer-active textarea,
    .chat-input-area.optimizer-end textarea {
      border: 1.5px solid transparent !important;
      background:
        linear-gradient(#ffffff, #ffffff) padding-box,
        linear-gradient(90deg, #34d399, #f59e0b, #ef4444, #8b5cf6, #06b6d4, #34d399) border-box !important;
      background-clip: padding-box, border-box !important;
      background-size: 300% 100% !important;
      will-change: background-position, opacity, transform;
    }
    html[data-theme='dark'] .chat-input-area.optimizer-start textarea,
    html[data-theme='dark'] .chat-input-area.optimizer-active textarea,
    html[data-theme='dark'] .chat-input-area.optimizer-end textarea {
      background:
        linear-gradient(var(--dark-input), var(--dark-input)) padding-box,
        linear-gradient(90deg, #34d399, #f59e0b, #ef4444, #8b5cf6, #06b6d4, #34d399) border-box !important;
      background-clip: padding-box, border-box !important;
    }

    /* Start: reveal from sparkles (right center) */
    .chat-input-area.optimizer-start textarea {
      animation: optimizer-start-reveal 240ms linear forwards;
      background-position: 100% 50%;
    }
    @keyframes optimizer-start-reveal {
      0% { background-position: 100% 50%; opacity: 0.6; }
      100% { background-position: 0% 50%; opacity: 1; }
    }

    /* Active: fast flowing spectrum (1.6s cycle, linear) */
    .chat-input-area.optimizer-active textarea {
      animation: optimizer-flow 1.7s linear infinite;
      background-position: 0% 50%;
    }
    @keyframes optimizer-flow {
      0%   { background-position: 0% 50%; }
      100% { background-position: 300% 50%; }
    }

    /* End: fade out border smoothly */
    .chat-input-area.optimizer-end textarea {
      animation: optimizer-end-fade 240ms linear forwards;
    }
    @keyframes optimizer-end-fade {
      0% { opacity: 1; }
      100% { opacity: 1; background-position: 300% 50%; filter: saturate(80%); }
    }

    /* Dim text during processing */
    .chat-input-area.optimizer-processing textarea { opacity: 0.6; transition: opacity 150ms ease; }

    /* Fade-in effect for new text */
    .chat-input-area .optimizer-text-fade { animation: optimizer-text-fade-in 240ms ease-out; }
    @keyframes optimizer-text-fade-in {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }

    /* Sparkles click pulse */
    .sparkles-pulse { animation: sparkles-pop 260ms ease-out; }
    @keyframes sparkles-pop {
      0% { transform: scale(0.9); filter: drop-shadow(0 0 0px rgba(250,204,21,0.0)); }
      60% { transform: scale(1.08); filter: drop-shadow(0 0 6px rgba(250,204,21,0.6)); }
      100% { transform: scale(1.0); filter: drop-shadow(0 0 0px rgba(250,204,21,0.0)); }
    }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.1.0",
    "react-dom/": "https://esm.sh/react-dom@^19.1.0/",
    "react/": "https://esm.sh/react@^19.1.0/",
    "@google/genai": "https://esm.sh/@google/genai@^1.0.1",
    "lucide-react": "https://esm.sh/lucide-react@^0.511.0",
    "marked": "https://esm.sh/marked@^13.0.2",
    "dompurify": "https://esm.sh/dompurify@^3.1.6"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-white text-gray-800">
  <div id="root"></div>
  <script type="module" src="/index.tsx"></script>
</body>
</html>
